<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.smartsuppchat.com">
    <link rel="preconnect" href="https://bootstrap.smartsuppchat.com">
    
    <!-- Content Security Policy - STRICT PRODUCTION POLICY -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self' 'unsafe-inline' https://www.smartsuppchat.com https://*.smartsuppchat.com;
      connect-src 'self' https://*.supabase.co https://api.supabase.com wss://*.supabase.co https://www.smartsuppchat.com https://bootstrap.smartsuppchat.com https://*.smartsuppchat.com https://widget-v3.smartsuppcdn.com;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      img-src 'self' data: https: blob:;
      font-src 'self' https://fonts.gstatic.com data:;
      frame-src 'self' https://www.smartsuppchat.com https://*.smartsuppchat.com;
      worker-src 'self' blob:;
      base-uri 'self';
      object-src 'none';
    ">
    
    <title>Kryvex - Advanced Crypto Trading Platform</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNiIgZmlsbD0iIzAwMDAwMCIvPgogIDxkZWZzPgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJmYXZpY29uIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I0ZGNkIwMDtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSI1MCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRjAwODA7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzgwMDBGRjtzdG9wLW9wYWNpdHk6MSIgLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDx0ZXh0IHg9IjE2IiB5PSIyMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0idXJsKCNmYXZpY29uKSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SzwvdGV4dD4KPC9zdmc+" />
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIGZpbGw9IiMwMDAwMDAiLz4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYXBwbGUiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojRkY2QjAwO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjUwJSIgc3R5bGU9InN0b3AtY29sb3I6I0ZGMDA4MDtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojODAwMEZGO3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHRleHQgeD0iOTAiIHk9IjExMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQ4IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0idXJsKCNhcHBsZSkiIHRleHQtYW5jaG9yPSJtaWRkbGUiPktSWVZFWDwvdGV4dD4KPC9zdmc+" />
    <meta name="description" content="Trade cryptocurrencies with confidence on Kryvex. Advanced trading tools, automated strategies, and professional-grade analytics for traders of all levels." />
    <meta name="author" content="Kryvex" />

    <meta property="og:title" content="Kryvex - Advanced Crypto Trading Platform" />
    <meta property="og:description" content="Trade cryptocurrencies with confidence on Kryvex. Advanced trading tools, automated strategies, and professional-grade analytics for traders of all levels." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.kryvextrading.com" />
    <meta property="og:image" content="https://www.kryvextrading.com/images/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Kryvex - Advanced Crypto Trading Platform" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@kryvextrading" />
    <meta name="twitter:creator" content="@kryvextrading" />
    <meta name="twitter:title" content="Kryvex - Advanced Crypto Trading Platform" />
    <meta name="twitter:description" content="Trade cryptocurrencies with confidence on Kryvex. Advanced trading tools, automated strategies, and professional-grade analytics for traders of all levels." />
    <meta name="twitter:image" content="https://www.kryvextrading.com/images/og-image.png" />
    <meta name="twitter:image:alt" content="Kryvex - Advanced Crypto Trading Platform" />

    <!-- Environment Configuration (Production Fallback) -->
    <script>
      // Provide environment variables as fallback for production builds
      window.env = {
        SUPABASE_URL: 'https://ftkeczodadvtnxofrwps.supabase.co',
        SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0a2Vjem9kYWR2dG54b2Zyd3BzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE5NzI5NzQsImV4cCI6MjA0NzU0ODk3NH0.Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8',
        NODE_ENV: 'production',
        BASE_URL: '/'
      };
      
      // Environment debugging (only in development)
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log('üîç ENVIRONMENT DEBUGGING:');
        console.log('NODE ENV:', window.env.NODE_ENV);
        console.log('BASE_URL:', window.env.BASE_URL);
        console.log('SUPABASE URL defined:', !!window.env.SUPABASE_URL);
        console.log('SUPABASE ANON KEY defined:', !!window.env.SUPABASE_ANON_KEY);
        console.log('All required environment variables are defined.');
      }
    </script>

    <!-- Smartsupp Live Chat script with enhanced error handling -->
    <script type="text/javascript">
      // Prevent Smartsupp errors from affecting React
      window.smartsuppErrors = [];
      
      var _smartsupp = _smartsupp || {};
      _smartsupp.key = '67805a30e60ab37fa695869a4b94967b14e41dbb';
      
      // Enhanced Smartsupp loader with comprehensive error handling
      window.smartsupp||(function(d) {
        var s,c,o=smartsupp=function(){ 
          try {
            o._.push(arguments);
          } catch (error) {
            // Silently handle Smartsupp errors to prevent React crashes
            window.smartsuppErrors.push(error);
          }
        };o._=[];
        s=d.getElementsByTagName('script')[0];c=d.createElement('script');
        c.type='text/javascript';c.charset='utf-8';c.async=true;
        c.src='https://www.smartsuppchat.com/loader.js?';
        
        // Add comprehensive error handling for script loading
        c.onerror = function() {
          if (window.env && window.env.NODE_ENV === 'development') {
            console.log('üîß Smartsupp script failed to load, using fallback');
          }
          window.smartsupp = null;
        };
        
        c.onload = function() {
          if (window.env && window.env.NODE_ENV === 'development') {
            console.log('‚úÖ Smartsupp script loaded successfully');
          }
        };
        
        // Prevent Smartsupp from throwing errors that affect React
        try {
          s.parentNode.insertBefore(c,s);
        } catch (error) {
          if (window.env && window.env.NODE_ENV === 'development') {
            console.log('üîß Smartsupp insertion failed:', error);
          }
          window.smartsupp = null;
        }
      })(document);
      
      // Global function to open chat with enhanced fallback
      window.openSmartsuppChat = function() {
        try {
          if (window.smartsupp && typeof window.smartsupp === 'function') {
            window.smartsupp('open');
          } else {
            throw new Error('Smartsupp not available');
          }
        } catch (error) {
          // Log error but don't let it crash the app
          if (window.env && window.env.NODE_ENV === 'development') {
            console.log('üîß Smartsupp widget failed, opening direct URL');
          }
          
          // Open direct URL as fallback
          try {
            window.open('https://widget-page.smartsupp.com/widget/67805a30e60ab37fa695869a4b94967b14e41dbb', '_blank', 'width=400,height=600');
          } catch (fallbackError) {
            // Even the fallback failed, but don't crash the app
            if (window.env && window.env.NODE_ENV === 'development') {
              console.log('üîß All Smartsupp fallbacks failed:', fallbackError);
            }
          }
        }
      };
      
      // Prevent Smartsupp from throwing global errors
      window.addEventListener('error', function(event) {
        if (event.filename && event.filename.includes('smartsupp')) {
          event.preventDefault();
          window.smartsuppErrors.push(event.error);
          return false;
        }
      });
    </script>
  </head>

  <body>
    <div id="root"></div>
    <noscript>
      <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
        <h1>JavaScript Required</h1>
        <p>This application requires JavaScript to function properly. Please enable JavaScript in your browser to continue.</p>
        <p>Powered by <a href="https://www.smartsupp.com" target="_blank">Smartsupp</a> for live chat support.</p>
      </div>
    </noscript>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
